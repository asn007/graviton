graviton
========

Relations and models for Meteor collections.

Allows you to:

* Define relationships between collections.
* Traverse and retrieve related models.
* Transform your mongo docs into models with attributes and methods.
* Use other mrt packages to handle validation (meteor-simple-schema) hooks (meteor-collection-hooks) and relational pub/sub (reactive-relations).
 
Collections defined with Graviton automatically convert retreieved objects into models. You specify the type(s) when define the collection. Passing {transform: null} to find() etc. will bypass model transformation. The raw document is stored in model.attributes. Use built-in transformation methods like set, push, pop to make changes to your model locally. Call model.save() to persist changes to the database. All methods work on both server and client.

# API Docs

## Meteor.Collection.prototype
The following are added to all your meteor collections:
* `all()` alias to find().fetch()
* `build()` returns a new local Gravition.Model based on your collection definition. Does not save to db.
* `create()` calls build() to generate a Model then inserts it into the db.

## Graviton
* `Graviton.define(collectionName, options)` Use to define your collections. Returns a Meteor.Collection instantiated with a transform function based on the options passed.

  *Options*
    * `persist` Passing false will define a local collection. default=true
    * `modelCls` Either a model constructor generated by calling Graviton.Model.extend or an object like {key1: ModelClsA, key2: ModelClsB} if you want polymorphism. `collection.build({_type: 'key2'})` would return an instance of ModelClsB.
    * `defaultType` Use when supplying a object for modelCls. Specify the type to use when object being transformed does not contain _type.
    * `timestamps` If true and you have the collection-hooks package installed, createdAt and updatedAt timestamps will be added to your models.
    * `<relationName>` Use to define relationships with other collections. See Relations section below.
    

* `Graviton.getProperty(key)` Use to access deeply-nested attributes without worry of throwing errors. Use period-delimited strings as keys. For example: `var obj = {}; Gravition.getPropery({}, 'some.deep.nested.prop')` would simply return undefined instead of throwing an error because obj.some is undefined. This method works best with keys that are meant to be stored in mongo since periods are not allowed in them.
* `Graviton.setProperty(thing, [value])` Set deeply-nested attributes. Example: `var obj = {}; Gravition.setProperty(obj, 'some.deeply.nested.prop', 'hello')` would result in `{some: {deeply: {nested: {prop: 'hello'}}}}` You can pass an object instead of key, value to set several at once.
* `Graviton.isModel(obj)` Use to check if an object is a model.

## Relations
Pass the following as keys to Graviton.define do declare relationships with other collections. Emample: 
```
Car = Graviton.define("cars", {
  belongsTo: {
    owner: {
      klass: 'people',
      foreignKey: 'ownerId'
    }
  },
  belongsToMany: {
    drivers: {
      klass: 'drivers',
      field: 'driverIds'
    }
  },
  hasOne: {
    manufacturer: {
      klass: 'manufacturers',
      foreignKey: 'carId'
    }
  },
  hasMany: {
    wheels: {
      klass: 'wheels',
      foreignKey: 'carId'
    }
  },
  embeds: {
    plate: {
      klass: 'plates'
    }
  },
  embedsMany: {
    windows: {
      klass: 'windows'
    }
  }
});
```
Would make the following possible:
```
var car = Car.findOne();
car.owner(); // returns a model
car.owner(person); // sets the ownerId of person

car.wheels.find(); // returns a cursor. same as Wheel.find({carId: car._id})
car.wheels.add({}); // insert a document into the wheels collection with carId = car._id

car.drivers.find(); // returns a cursor. same as Driver.find({_id: {$in: car.get('driverIds')}})

car.manufacturer();
car.plate();

// embedded models don't have the same finder capability since they aren't kept in minimongo
car.windows.all(); // returns all models
car.windows.at(2); // only builds one model
```

## Graviton.Model

# Example

coming soon



